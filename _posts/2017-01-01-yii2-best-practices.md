---
layout: post
title: 个人 yii2 最佳实践
description: 分享一些人生的经验，持续更新中
date: 2017-01-01 00:00:00
category: yii2
tags: yii2
---

## 前言

讲一下我 yii2 之路的历史：我在15年10月的时候开始了第一份工作，那时候我是超级菜，直接就接触了 yii2 框架，第一个月都是被骂过来的，老大封装了和改写了好多东西，平时用起来挺轻松的。到了16年1月因为某些原因大家都离职了，由于太菜，一直到4月才找到第二份工作，几个 php 里除了我别的都是80后的，项目都很原始，写代码超级繁琐，于是大概5月底的时候我开始自学 yii2，注册了 GitHub，创建了第一个 git 仓库 [hello-yii2](https://github.com/hubeiwei/hello-yii2)，尝试把学到的觉得好的东西改成自己的。

我也不知道是什么时候开始加技术群的，发现不会的新手好多，能回答的问题我都抢着回答了，平时有空也去抠代码，渐渐对 yii2 比较基础的东西越来越熟悉，就打算开这一个大坑，希望能让一些新人少踩坑。

本文内容纯属个人观点，仅供参考。

## yii2 的优点

1. 纯面向对象，内置大量 PHPDoc，提高了 IDE 的编码效率和准确性。

2. 组件，提高了类的复用性和灵活性。

3. gii 快速生成 model 和 crud 代码，有了自己的习惯后可以做自己的模板。

4. 提供了 debug 面板，方便分析性能和错误。

5. 前端布局和资源发布：统一了个人与第三方页面的结构和资源加载。widget：无需关注资源加载，简单调用即可获得前端插件。

## yii2 的缺点

1. 学习曲线较高，尤其是面向对象不熟还不用 IDE 编码的新人。

2. 知识点多，需要把很多知识点结合起来才能发挥框架更大的作用。

3. 对不深入了解别人封装，喜欢自己动手造轮子的人不友好。

4. 和其他的框架截然不同的写法，甚至会出现前端页面全是用 PHP 代码来写的情况。

## 框架结构、官方模板的选择

框架的代码在 vendor 目录内由 [composer](http://docs.phpcomposer.com/) 管理，另外还有 composer.json 和 composer.lock 两个 composer 的文件，别的目录都是由自己设计，自由度很高。

另外建议了解一下 composer，这是现代 php 程序员都应该要学的一项技能。

官方提供了基础和高级两个模板：基础模板提供是单个网站的结构。高级模板提供的是多个网站的结构，在每个网站**有自己独立配置**的同时，还能共用 vendor 目录和自己封装的代码以及一些公共配置，高级模板默认的两个网站一个叫 frontend，一个叫 backend，就是前台和后台的意思。

即使你不懂 git，也要去了解一下 `.gitignore` 文件的作用，这样你才能知道官方的两个模板里，哪些文件可以提交到版本控制，哪些文件不可以。

在模板选择方面，由于一些新人喜欢用百度，挺容易搜到“实现前后台用高级模板”之类的建议，于是有些新人一开始就用了高级模板，可能会造成上手困难之类的问题。其实你完全可以无视前台后台这个命名，就像我说的这样认为是多个网站就行，实际要做一个要求不高的前后台，我用基础模板结合框架的模块就足矣，当然如果你要是想以后方便增加新项目又方便维护自己封装的代码，那么用高级模板来做一个网站也是不错的（就是 frontend 和 backend 只保留一个，改成其他名字），这些就是我给出的框架模板选择的建议，当然能自己设计那是坠吼的。

## 网站搭建的正确姿势

很多新人都喜欢在 windows 上用集成环境，把项目直接丢到 www 目录里运行，这种习惯很明显是不对的，路由用框架的方法生成还好，但前端资源的加载可能会遇到各种路径的问题，在开发时应该让环境尽可能的接近生产环境，正确的姿势应该是搭建 vhost，**以每一个网站的 web 目录为域名的根目录**，有些用高级模板的新人用一个域名指向项目根目录也是不对的，高级模板里有多少个网站，就要配多少个域名，最好是能够开启 url 美化以及隐藏脚本文件名，这样的 url 看起来非常简洁。

具体配置 vhost 方法你可以 google 或者参考官方的[文档](https://github.com/yiisoft/yii2/blob/master/docs/guide-zh-CN/start-installation.md#配置-web-服务器-)，nginx 也可以看[这篇文章](http://www.getyii.com/topic/31)。

## PHPStorm

1. [laracasts 的视频](https://laracasts.com/series/how-to-be-awesome-in-phpstorm)

2. [PhpStorm Tips](phpstorm.tips)

3. [让 yii2 自定义组件支持 PHPStorm 代码提示]({% post_url 2016-08-20-yii2-ide-helper %})

> 更多内容正在建设中......

## 框架基本套路

上面介绍了 PHPStorm 这个 IDE，就是为了能让你认识 yii2 的基本套路后，可以更快速的定位源码。

yii2 的基本套路，就是配置，你可以在配置里随意指定你要用的类，具体在[这篇文章]({% post_url 2016-07-02-yii2-configuration %})内。

## gii

动手写代码前，应该先参考一下 gii 生成的 model 和 crud 的代码，这样你才会少走弯路，用法挺简单的，我觉得这里就不需要多说明了，如果实在觉得自己看不懂，推荐去慕课网找找gii相关的教学视频。

印象最深的：有些新人在做修改时居然把 model 给 new 出来，对主键赋值后又执行 `save()`，甚至有的人还用上了场景，搞了一天都不成功，还有的人最后选择了手动写 sql。

## grid

yii2 的 `GridViewer` 应该算是挺好用的了，传统的表格你经常需要用 php 和 html 大量拼接，甚至要写js，才能实现各种字段的排序、搜索等功能，而这些基本的功能 yii2 给你封装好了，使用 gii 生成 crud 的列表页就有 grid，生成后为了个性化要改的代码说多也不多，总之我觉得习惯之后封装起来是挺方便的，以下给出两篇比较基础的文章，以后还会再加更多的进阶技巧，请多关注。

1. [grid 基础]({% post_url 2016-11-02-yii2-grid %})

2. [grid 导出]({% post_url 2016-11-10-yii2-grid-export %})

> 更多内容正在建设中......

## 查询

我觉得 yii2 的查询构造器相对别的框架是挺方便的，已经快1年没在 yii2 上拼接原生的 sql 字符串了，内容可能较多，所以我暂定在另外一个[仓库](https://github.com/hubeiwei/yii2-query-skill)写，目前还在规划中，说不定以后又在这个网站拆分成多篇文章来写。

## 打赏

如果觉得我做的内容对你有帮助的话，求打赏，以后我会有更多动力去学习和分享更多 yii2 的内容。

![alipay](https://raw.githubusercontent.com/hubeiwei/hubeiwei.github.io/master/images/pay/ali_pay.jpg "支付宝")

![wechat](https://raw.githubusercontent.com/hubeiwei/hubeiwei.github.io/master/images/pay/wechat_pay.png "微信")
